<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>金沙蛋黃酥 - 線上訂購</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet"/>
  <meta name="description" content="一口酥香，滿心溫暖"/>
  <style>
    body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
    /* 隱藏 number input 的上下箭頭 */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none; margin: 0;
    }
    input[type=number] { -moz-appearance: textfield; }
    /* Modal 動畫 */
    .modal-backdrop { transition: opacity 0.3s ease; }
    .modal-content { transition: transform 0.3s ease; }
    button:disabled { cursor: not-allowed; opacity: 0.7; }
    /* 自訂下拉箭頭 */
    .custom-select {
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 8l4 4 4-4' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.25rem 1.25rem;
      -webkit-appearance: none; -moz-appearance: none; appearance: none;
      padding-right: 2.5rem;
    }
  </style>
</head>
<body class="bg-amber-50">
  <div class="container mx-auto p-4 sm:p-8 max-w-4xl">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold text-amber-800">金沙蛋黃酥</h1>
      <p class="text-amber-600 mt-2 text-lg">每日現烤，傳遞手心的溫度</p>
    </header>

    <main class="bg-white rounded-2xl shadow-lg overflow-hidden md:grid md:grid-cols-2 md:gap-0">
      <!-- 左側圖片：已改為 S__28688692.jpg -->
      <div class="md:col-span-1">
        <img
          src="./S__28688692.jpg"
          alt="美味的蛋黃酥照片"
          class="w-full h-full object-cover"
          onerror="this.onerror=null;this.src='https://placehold.co/600x700/FDE68A/422006?text=%E5%9C%96%E7%89%87%E8%BC%89%E5%85%A5%E5%A4%B1%E6%95%97';"
        />
      </div>

      <!-- 右側表單 -->
      <div class="md:col-span-1 p-8 flex flex-col">
        <form id="orderForm" novalidate class="flex flex-col h-full">
          <div class="flex-grow">
            <!-- 訂購選項 -->
            <h2 class="text-2xl font-bold text-gray-800 mb-4">訂購選項</h2>
            <div id="order-items" class="space-y-4">
              <!-- 品項 1 -->
              <div class="order-item grid grid-cols-5 gap-2 items-center" data-price="300">
                <div class="col-span-3">
                  <p class="font-semibold">透明盒 (6入)</p>
                  <p class="text-sm text-gray-600">NT$ 300</p>
                </div>
                <div class="col-span-2 flex justify-end items-center">
                  <button type="button" class="minus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-l-lg hover:bg-gray-300">-</button>
                  <input type="number" name="quantity_transparent_6" value="0" min="0"
                         class="quantity-input w-12 text-center border-t border-b border-gray-200 h-8 focus:outline-none"/>
                  <button type="button" class="plus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-r-lg hover:bg-gray-300">+</button>
                </div>
              </div>

              <!-- 品項 2 -->
              <div class="order-item grid grid-cols-5 gap-2 items-center" data-price="320">
                <div class="col-span-3">
                  <p class="font-semibold">禮盒裝 (6入)</p>
                  <p class="text-sm text-gray-600">NT$ 320</p>
                </div>
                <div class="col-span-2 flex justify-end items-center">
                  <button type="button" class="minus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-l-lg hover:bg-gray-300">-</button>
                  <input type="number" name="quantity_gift_6" value="0" min="0"
                         class="quantity-input w-12 text-center border-t border-b border-gray-200 h-8 focus:outline-none"/>
                  <button type="button" class="plus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-r-lg hover:bg-gray-300">+</button>
                </div>
              </div>

              <!-- 品項 3 -->
              <div class="order-item grid grid-cols-5 gap-2 items-center" data-price="320">
                <div class="col-span-3">
                  <p class="font-semibold">禮盒裝 (12入)</p>
                  <p class="text-sm text-gray-600">NT$ 320</p>
                </div>
                <div class="col-span-2 flex justify-end items-center">
                  <button type="button" class="minus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-l-lg hover:bg-gray-300">-</button>
                  <input type="number" name="quantity_gift_12" value="0" min="0"
                         class="quantity-input w-12 text-center border-t border-b border-gray-200 h-8 focus:outline-none"/>
                  <button type="button" class="plus-btn bg-gray-200 text-gray-700 font-bold w-8 h-8 rounded-r-lg hover:bg-gray-300">+</button>
                </div>
              </div>
            </div>

            <hr class="my-6"/>

            <!-- 取貨日期 -->
            <div class="mb-4">
              <label for="pickupDate" class="block text-gray-700 font-bold mb-2">希望取貨日期</label>
              <select id="pickupDate" name="pickupDate" required
                      class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 bg-white custom-select">
                <option value="" disabled selected>請選擇取貨日期</option>
                <option value="2025/09/26 (五)">2025/09/26 (五)</option>
                <option value="2025/09/29 (一)">2025/09/29 (一)</option>
                <option value="2025/10/03 (五)">2025/10/03 (五)</option>
              </select>
            </div>

            <!-- 訂購人姓名 -->
            <div class="mb-4">
              <label for="customerName" class="block text-gray-700 font-bold mb-2">訂購人姓名</label>
              <input type="text" id="customerName" name="customerName" placeholder="請填寫您的姓名" required
                     class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"/>
            </div>

            <!-- 聯絡電話 -->
            <div class="mb-4">
              <label for="customerPhone" class="block text-gray-700 font-bold mb-2">聯絡電話</label>
              <input type="tel" id="customerPhone" name="customerPhone" placeholder="請填寫您的手機號碼" required
                     class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"/>
            </div>
          </div>

          <div class="mt-auto">
            <div class="flex justify-between items-center mb-4">
              <span class="text-xl font-bold text-gray-800">訂單總金額</span>
              <span id="total-price" class="text-3xl font-bold text-amber-700">NT$ 0</span>
            </div>
            <button type="submit"
                    class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition">
              確認訂購
            </button>
          </div>
        </form>
      </div>
    </main>

    <footer class="text-center mt-8">
      <p class="text-gray-500">有任何問題嗎？歡迎來電：0913-607-732</p>
    </footer>
  </div>

  <!-- Modal -->
  <div id="confirmationModal"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 modal-backdrop opacity-0 pointer-events-none">
    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center modal-content transform scale-95">
      <h3 class="text-2xl font-bold text-green-600 mb-4">訂購成功！</h3>
      <p class="text-gray-700 mb-2">我們已收到您的訂單，感謝您的訂購。</p>
      <p class="text-gray-600 mb-6 text-sm">您的訂單資料已成功記錄！</p>
      <button id="closeModalBtn"
              class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors">
        關閉
      </button>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw9t43BogzGpFEk7lizkPTleABUUBfA2LkIdozQyL3iQT38RK4fQ5MldNsORowYXQBz4Q/exec';

    const orderForm = document.getElementById('orderForm');
    const orderItemsContainer = document.getElementById('order-items');
    const totalPriceEl = document.getElementById('total-price');
    const confirmationModal = document.getElementById('confirmationModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalBackdrop = document.querySelector('.modal-backdrop');
    const modalContent = document.querySelector('.modal-content');
    const submitButton = orderForm.querySelector('button[type="submit"]');

    function updateTotalPrice() {
      let total = 0;
      const items = orderItemsContainer.querySelectorAll('.order-item');
      items.forEach(item => {
        const price = parseFloat(item.dataset.price);
        const quantity = parseInt(item.querySelector('.quantity-input').value, 10) || 0;
        total += price * quantity;
      });
      totalPriceEl.textContent = `NT$ ${total}`;
    }

    orderItemsContainer.addEventListener('click', (e) => {
      const target = e.target;
      const item = target.closest('.order-item');
      if (!item) return;

      const input = item.querySelector('.quantity-input');
      let quantity = parseInt(input.value, 10) || 0;

      if (target.classList.contains('plus-btn')) {
        quantity++;
      } else if (target.classList.contains('minus-btn')) {
        quantity = Math.max(0, quantity - 1);
      }

      input.value = quantity;
      updateTotalPrice();
    });

    orderItemsContainer.addEventListener('change', (e) => {
      if (e.target.classList.contains('quantity-input')) {
        const v = parseInt(e.target.value, 10);
        if (isNaN(v) || v < 0) e.target.value = 0;
        updateTotalPrice();
      }
    });

    function showModal() {
      confirmationModal.classList.remove('pointer-events-none');
      modalBackdrop.classList.remove('opacity-0');
      modalContent.classList.remove('scale-95');
    }

    function hideModal() {
      modalBackdrop.classList.add('opacity-0');
      modalContent.classList.add('scale-95');
      setTimeout(() => {
        confirmationModal.classList.add('pointer-events-none');
      }, 300);
    }

    orderForm.addEventListener('submit', function (event) {
      event.preventDefault();

      const formData = new FormData(orderForm);
      const orderData = Object.fromEntries(formData.entries());

      let totalQuantity = 0;
      let totalPrice = 0;
      orderItemsContainer.querySelectorAll('.order-item').forEach(item => {
        const price = parseFloat(item.dataset.price);
        const inputName = item.querySelector('.quantity-input').name;
        const q = parseInt(orderData[inputName], 10) || 0;
        totalQuantity += q;
        totalPrice += price * q;
      });

      if (totalQuantity === 0) {
        alert('請至少選擇一樣商品！');
        return;
      }

      orderData.totalPrice = totalPrice;

      const originalButtonText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = `
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg> 送出中...`;

      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'cors',
        cache: 'no-cache',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(orderData),
      })
      .then(res => res.json())
      .then(data => {
        if (data.result === 'success') {
          showModal();
          orderForm.reset();
          orderItemsContainer.querySelectorAll('.quantity-input').forEach(input => input.value = 0);
          updateTotalPrice();
        } else {
          throw new Error(data.error || '未知的錯誤');
        }
      })
      .catch(error => {
        console.error('傳送失敗:', error);
        alert(`訂單傳送失敗！\n錯誤訊息：${error.message}`);
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
      });
    });

    closeModalBtn.addEventListener('click', hideModal);
    confirmationModal.addEventListener('click', (e) => {
      if (e.target === confirmationModal) hideModal();
    });

    // 頁面載入時初始化總金額
    updateTotalPrice();
  </script>
</body>
</html>
